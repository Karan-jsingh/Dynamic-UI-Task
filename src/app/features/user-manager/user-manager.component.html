<div *ngIf="!schema">Loading UI schema...</div>
<mat-tab-group *ngIf="schema && schema.formTabs" [(selectedIndex)]="activeTabIndex">
    <mat-tab label="User List">
        <div class="table-container">
            <table mat-table [dataSource]="userList" class="mat-elevation-z2">
                <ng-container *ngFor="let col of schema.listColumns" [matColumnDef]="col.columnName">
                    <th mat-header-cell *matHeaderCellDef>{{ col.displayName }}</th>
                    <td mat-cell *matCellDef="let row">{{ row[col.columnName] }}</td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="onRowSelect(row)"></tr>
            </table>
        </div>
    </mat-tab>
    <mat-tab *ngFor="let tab of schema.formTabs; let i = index" [label]="tab.title">
        <form [formGroup]="formGroups[i]" class="form-container">
            <div class="toggle-container">
                <label class="toggle-label">
                    <input type="checkbox" [checked]="showEmptyFields" (change)="onToggleShowEmptyFields($event)" />
                    Show Empty Fields
                </label>
            </div>

            <div class="form-grid">
                <ng-container *ngFor="let field of tab.fields">
                    <div *ngIf="showEmptyFields || formGroups[i].get(field.fieldName)?.value" class="form-entry">
                        <label class="form-label"
                            [style.visibility]="field.labelpos?.x === 0 && field.labelpos?.y === 0 ? 'hidden' : 'visible'"
                            [ngStyle]="{
                'grid-column': (field.labelpos?.x ?? 0) + 1,
                'grid-row': (field.labelpos?.y ?? 0) + 1
            }">
                            {{ field.label || field.fieldName }}
                        </label>
                        <input [type]="field.type || 'text'" [formControlName]="field.fieldName" class="form-input"
                            [ngStyle]="{
                'grid-column': (field.inputpos?.x ?? 0) + 1,
                'grid-row': (field.inputpos?.y ?? 0) + 1
              }" />
                    </div>
                </ng-container>
            </div>
            <div class="button-row">
                <button type="button" (click)="onSubmit()">ðŸ’¾ Save</button>
            </div>
        </form>
    </mat-tab>
</mat-tab-group>